# VIGIA Medical AI - Entity States

## Objetivo
Estados crÃ­ticos del dominio mÃ©dico: ciclo de vida de sesiones mÃ©dicas, estados de anÃ¡lisis de agentes y transiciones de emergencia para compliance.

## CÃ³digo Eraser.io
```
autoNumber on
colorMode bold

// Medical Session Lifecycle
Session [icon: clock, color: blue]
PHI_Tokenizer [icon: shield, color: red]
Master_Orchestrator [icon: hub, color: purple]
Medical_Agents [icon: users, color: green]
Medical_Team [icon: users, color: orange]
Patient [icon: user, color: blue]

// Phase 1: Session Creation
Patient > Session: "ğŸ¥ Medical case initiated"
activate Session
Session > PHI_Tokenizer: "Create Batman token"
activate PHI_Tokenizer

alt [label: "PHI Tokenization Success"] {
  PHI_Tokenizer > Session: "âœ… Token: batman_TC001\nâ±ï¸ 15min timeout"
  Session > Session: "State: ACTIVE\nğŸŸ¢ Ready for processing"
}
else [label: "PHI Tokenization Failed"] {
  PHI_Tokenizer > Session: "âŒ Tokenization failed"
  Session > Session: "State: FAILED\nğŸ”´ Invalid patient data"
  Session > Patient: "âŒ Unable to process"
  deactivate Session
}
deactivate PHI_Tokenizer

// Phase 2: Medical Processing States
Session > Master_Orchestrator: "ğŸš€ Begin medical analysis"
activate Master_Orchestrator
Master_Orchestrator > Session: "State: PROCESSING\nğŸŸ¡ Agents coordinating"

// Agent Analysis States
Master_Orchestrator > Medical_Agents: "Coordinate 9-agent analysis"
activate Medical_Agents

par [label: "Agent Processing States"] {
  Medical_Agents > Medical_Agents: "Image Agent: ANALYZING\nğŸ” MONAI processing..."
}
and {
  Medical_Agents > Medical_Agents: "Clinical Agent: ASSESSING\nğŸ©º Risk evaluation..."
}
and {
  Medical_Agents > Medical_Agents: "Protocol Agent: REVIEWING\nğŸ“‹ NPUAP guidelines..."
}

// Critical Decision Point
alt [label: "High Confidence Analysis (>90%)"] {
  Medical_Agents > Master_Orchestrator: "âœ… Analysis: COMPLETE\nğŸ¯ Confidence: 94%"
  Master_Orchestrator > Session: "State: ANALYZED\nğŸŸ¢ High confidence results"
}
else [label: "Low Confidence Analysis (<80%)"] {
  Medical_Agents > Master_Orchestrator: "âš ï¸ Analysis: UNCERTAIN\nğŸ¯ Confidence: 76%"
  Master_Orchestrator > Session: "State: REQUIRES_REVIEW\nğŸŸ¡ Human review needed"
}
else [label: "Critical Emergency Detected"] {
  Medical_Agents > Master_Orchestrator: "ğŸš¨ Analysis: EMERGENCY\nâš ï¸ Grade 4 LPP detected"
  Master_Orchestrator > Session: "State: EMERGENCY\nğŸ”´ Immediate action required"
}

deactivate Medical_Agents

// Phase 3: Medical Team Coordination
alt [label: "Emergency State"] {
  Master_Orchestrator > Medical_Team: "ğŸš¨ URGENT: Grade 4 LPP\nâ° <15min response required"
  activate Medical_Team
  Medical_Team > Session: "State: EMERGENCY_ESCALATED\nğŸ‘¨â€âš•ï¸ Dr. Smith responding"
  Session > Session: "Priority: CRITICAL\nâ±ï¸ Extend timeout to 30min"
}
else [label: "Normal Analysis"] {
  Master_Orchestrator > Medical_Team: "ğŸ“Š Analysis complete\nâœ… Results available"
  activate Medical_Team
  Medical_Team > Session: "State: TEAM_NOTIFIED\nğŸ“‹ Standard review process"
}

deactivate Master_Orchestrator

// Phase 4: Patient Communication States
Medical_Team > Patient: "Medical results transmission"
activate Patient

alt [label: "Emergency Communication"] {
  Patient > Session: "State: EMERGENCY_COMMUNICATED\nğŸš¨ Urgent care instructions sent"
}
else [label: "Standard Communication"] {
  Patient > Session: "State: RESULTS_DELIVERED\nâœ… Standard results provided"
}

// Phase 5: Session Completion
Session > Session: "State: COMPLETED\nğŸ“‹ Medical case closed"

// Audit Trail Completion
Session > Session: "Audit: LOGGED\nğŸ”’ HIPAA compliance verified"
deactivate Medical_Team
deactivate Patient

// Timeout Handling
par [label: "Session Timeout Management"] {
  loop [label: "Every 5 minutes"] {
    Session > Session: "Check session timeout\nâ±ï¸ Current: 12min remaining"
    
    alt [label: "Timeout Warning (5min left)"] {
      Session > Patient: "âš ï¸ Session expires in 5min\nğŸ”„ Extend if needed"
    }
    else [label: "Session Expired"] {
      Session > Session: "State: EXPIRED\nğŸ”´ Session terminated"
      Session > PHI_Tokenizer: "ğŸ—‘ï¸ Cleanup Batman token"
      deactivate Session
    }
  }
}

// State Transition Summary
note over Session, Patient: "ğŸ“Š SESSION STATES:\nğŸŸ¢ ACTIVE â†’ PROCESSING â†’ ANALYZED\nğŸŸ¡ REQUIRES_REVIEW â†’ TEAM_NOTIFIED\nğŸ”´ EMERGENCY â†’ EMERGENCY_ESCALATED\nâœ… COMPLETED â†’ EXPIRED"
```

## Notas Clave
- **15-min Session Timeout**: Seguridad PHI con extensiÃ³n automÃ¡tica para emergencias crÃ­ticas
- **Emergency State Machine**: Grade 4 LPP â†’ immediate escalation con timeout extendido a 30min
- **9-Agent Coordination**: Estados paralelos de anÃ¡lisis con confidence thresholds
- **Complete Audit Trail**: Cada transiciÃ³n de estado registrada para HIPAA compliance

## Para Editar
1. Copia el cÃ³digo anterior
2. Ve a [eraser.io](https://eraser.io)
3. Crea nuevo diagrama â†’ Diagram-as-code
4. Pega el cÃ³digo y edita