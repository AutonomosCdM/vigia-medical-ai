# VIGIA Medical AI - AWS Serverless Critical User Flow

## Objetivo
Happy path serverless: paciente envÃ­a imagen â†’ API Gateway â†’ Step Functions coordina 9 Lambda agents â†’ DynamoDB state â†’ equipo mÃ©dico vÃ­a Slack â†’ autonomos.dev response.

## CÃ³digo Eraser.io
```
autoNumber on
colorMode bold

// AWS Serverless Actors
Patient [icon: user, color: blue]  
WhatsApp_Bot [icon: mobile, color: green]
API_Gateway [icon: aws-apigateway, color: purple]
Lambda_PHI_Tokenizer [icon: aws-lambda, color: red]
Step_Functions_Orchestrator [icon: aws-stepfunctions, color: purple]
Lambda_Medical_Agents [icon: aws-lambda, color: blue]
AWS_Bedrock_MONAI [icon: aws-bedrock, color: green]
DynamoDB_State [icon: aws-dynamodb, color: orange]
Medical_Team [icon: users, color: orange]
Lambda_Slack_Integration [icon: slack, color: purple]

// Phase 1: Patient Input & AWS Serverless Processing
Patient > WhatsApp_Bot: "ğŸ–¼ï¸ Pressure ulcer image\nğŸ“ MRN: BW-2025-001"
activate WhatsApp_Bot
WhatsApp_Bot > API_Gateway: "ğŸŒ autonomos.dev/medical/analyze"
activate API_Gateway
API_Gateway > Lambda_PHI_Tokenizer: "â˜ï¸ Lambda cold start (2s)\nğŸ”’ Patient data validation"
activate Lambda_PHI_Tokenizer
Lambda_PHI_Tokenizer > DynamoDB_State: "Bruce Wayne â†’ Batman token\nbatman_TC001_abc123"
activate DynamoDB_State
DynamoDB_State > Lambda_PHI_Tokenizer: "âœ… Token stored\nâ±ï¸ 15min session TTL"
deactivate DynamoDB_State
Lambda_PHI_Tokenizer > API_Gateway: "âœ… Token created\nğŸ” KMS encrypted"
deactivate Lambda_PHI_Tokenizer
API_Gateway > WhatsApp_Bot: "âœ… AWS processing initiated"
deactivate API_Gateway
WhatsApp_Bot > Patient: "âœ… Image received\nâ˜ï¸ AWS medical analysis starting..."
deactivate WhatsApp_Bot

// Phase 2: Step Functions Medical Orchestration
activate Step_Functions_Orchestrator
Step_Functions_Orchestrator > Lambda_Medical_Agents: "ğŸ”„ Step Functions workflow\nğŸš€ 9-agent Lambda coordination"
activate Lambda_Medical_Agents

// Parallel AWS Medical Analysis
par [label: "Step Functions Parallel Execution"] {
  Lambda_Medical_Agents > AWS_Bedrock_MONAI: "ğŸ”¬ Bedrock + SageMaker MONAI analysis"
  activate AWS_Bedrock_MONAI
  AWS_Bedrock_MONAI > Lambda_Medical_Agents: "ğŸ“Š MONAI: Grade 4 LPP detected\nğŸ¯ Confidence: 94%"
  deactivate AWS_Bedrock_MONAI
}
and {
  Lambda_Medical_Agents > DynamoDB_State: "ğŸ©º Clinical assessment state\nâš ï¸ Risk factors analysis"
  activate DynamoDB_State
  DynamoDB_State > Lambda_Medical_Agents: "âœ… State updated"
  deactivate DynamoDB_State
}
and {
  Lambda_Medical_Agents > Lambda_Medical_Agents: "ğŸ“‹ NPUAP protocol Lambda\nğŸ“– Evidence-based recommendations"
}

Lambda_Medical_Agents > Step_Functions_Orchestrator: "ğŸš¨ CRITICAL: Grade 4 LPP\nâ° Step Functions: surgical evaluation required"
deactivate Lambda_Medical_Agents
Step_Functions_Orchestrator > DynamoDB_State: "ğŸ’¾ Final medical state stored"
activate DynamoDB_State
DynamoDB_State > Step_Functions_Orchestrator: "âœ… Audit trail complete"
deactivate DynamoDB_State
deactivate Step_Functions_Orchestrator

// Phase 3: Lambda Slack Medical Team Communication
activate Lambda_Slack_Integration
Lambda_Slack_Integration > Medical_Team: "ğŸš¨ URGENT MEDICAL ALERT\nğŸ‘¤ Patient: batman_TC001\nğŸ“Š Grade 4 LPP detected\nğŸ¯ Confidence: 94%\nâ˜ï¸ Source: AWS Lambda analysis\nâ° Response needed: <15min"
activate Medical_Team
Medical_Team > Lambda_Slack_Integration: "âœ… Dr. Smith reviewing\nğŸ“ Contacting patient now"
Lambda_Slack_Integration > DynamoDB_State: "ğŸ‘¨â€âš•ï¸ Dr. Smith response logged"
activate DynamoDB_State
DynamoDB_State > Lambda_Slack_Integration: "âœ… Response tracked"
deactivate DynamoDB_State
deactivate Medical_Team
Lambda_Slack_Integration > Step_Functions_Orchestrator: "âœ… Medical team notified\nğŸ‘¨â€âš•ï¸ Dr. Smith responding"
deactivate Lambda_Slack_Integration

// Phase 4: Patient Response via autonomos.dev
activate WhatsApp_Bot
WhatsApp_Bot > Patient: "ğŸ¥ URGENT MEDICAL ALERT\nğŸ“Š Grade 4 pressure injury detected\nğŸ‘¨â€âš•ï¸ Dr. Smith will contact you\nğŸ“ Call: (555) 123-4567\nğŸŒ Track: autonomos.dev\nâ° Immediate evaluation required"
Patient > WhatsApp_Bot: "âœ… Understood, thank you"
WhatsApp_Bot > API_Gateway: "ğŸŒ autonomos.dev case reference\nğŸ“‹ Reference: batman_TC001"
activate API_Gateway
API_Gateway > DynamoDB_State: "ğŸ“ Patient acknowledgment logged"
activate DynamoDB_State
DynamoDB_State > API_Gateway: "âœ… Final state updated"
deactivate DynamoDB_State
API_Gateway > WhatsApp_Bot: "âœ… Case logged in AWS"
deactivate API_Gateway
WhatsApp_Bot > Patient: "âœ… Medical case logged\nğŸ“‹ Reference: batman_TC001\nğŸŒ Status: autonomos.dev"
deactivate WhatsApp_Bot

// AWS Serverless Audit Trail
note over Lambda_PHI_Tokenizer, Lambda_Slack_Integration: "ğŸ“ Complete DynamoDB audit trail\nğŸ”’ AWS KMS HIPAA compliance\nâ˜ï¸ Step Functions workflow logged\nâ±ï¸ Total serverless response: <3 minutes"
```

## Notas Clave
- **Sub-3 minutos serverless**: AWS Lambda + Step Functions response time
- **9 Lambda Agents**: Step Functions coordina anÃ¡lisis mÃ©dico paralelo
- **AWS AI Stack**: Bedrock + SageMaker MONAI para Grade 4 LPP detection
- **DynamoDB State Management**: Complete audit trail con KMS encryption
- **Production Domain**: autonomos.dev tracking con API Gateway integration
- **HIPAA Serverless**: AWS KMS, DynamoDB encryption, Lambda execution roles

## Para Editar
1. Copia el cÃ³digo anterior
2. Ve a [eraser.io](https://eraser.io)
3. Crea nuevo diagrama â†’ Diagram-as-code
4. Pega el cÃ³digo y edita